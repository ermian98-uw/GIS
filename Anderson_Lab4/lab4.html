<!DOCTYPE html>

<!-- Eric Anderson -->
<!-- TGIS 503 -->
<!-- Lab 4 -->
<!-- lab4.html -->

<html>
  <head> <!-- Head -->
    <title> Lab 4 - Storytelling Through Maps </title>
    <!-- CSS Styles -->
    <link rel="stylesheet" href="style.css" type="text/css">
    <link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />

    <!-- Mapbox GL library Links -->
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"> </script>

    <script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=TyZRjTrLBW0ttWqVVFcf_da7oyw3rR9vbYcD5OQoLp3UJbbarDbKf83aCH2xps_ddG62VhIPl6U5uucr1utttBPNYr_kW0uS1tYEtbO1ROx3_0WsZkaH5NUqUJf7ZyWVstvZDQoBeTnYJoL9TkbmW6XFIa9oCHYC2QouoFmD7gQtdwJW5qS-Phz1D16hfNBqtEeJks1ks9_z2v6NgmKba62hLglP4DK-LIUcCsGsGsZZV_FQLdHCDc012nzDQXPKK-_baTlMDBFFIBd74RfQ5Xx6N1e7K5-ddTX7tfxHOEYJ52o4_1aM78LaSXuQJMV8xFxejbAF0P5rZBYw3oHIG1vl9dEganbJ5gxfzzIbkoNu49vAm8Kr8a9knJuFbgHH90U_vvaODcnbwGsBNtokjhDUUdIIVbx53sJQg2PnbKRSe5KhW_2ClHUA2E3-j3nuX5nqlOQfZwoTCilbkx-1z6CideEUCNCDC4X_Aa85iKwDMvmf6RjYxASVj2VfQitJMOXGlS5xiUJ88Qw-xf3HdSwymCmIsWD2kKHIAXTokwY4YcQLLVX5CkWcBMHiutbfjoAxGWIM6wyBfqrlR_an8BJ4IHyxW5AW0AzHvAZgO0x6s4BzR9FJ2mjd_Rpx1iftVfRYgXX11Te-c7BHT6ni8Ty-sOcBb6DXfnUBhJF6RFk" charset="UTF-8"></script>
  </head>

  <body>
    <p> <br> </p> <!-- Title of page -->
    <h1 style="font-variant:small-caps;"> Examining Texas Climate in 1999 </h1>
    <p> <br> </p>
    <p> <br> </p>
    <center> <p id="divide" <br> ERIC ANDERSON <br> TGIS 503 </p> </center>
    <p> <br> </p>
    <p> <br> </p>
    <p style="font-size:115%;text-align:center;"> <br> A common metric for identifying global warming due to climate change is the "temperature anomaly" from a previous era (such as the 19th or 20th century average). Across the majority of the planet, these anomaly values are in the positive, including most parts of Texas. On this webpage, we will visualize temperature anomalies by county by month in 1999. We will also consider monthly precipitation accumulation. </p>
    <p> <br> </p>
    <p> <br> </p>
    <p style="font-size:95%;text-align:center;"> <br> <i> (Use Google Chrome full screen for best user experience) </i> </p>
    <p id="divide">
    <p> <br> </p>
    <p> <br> </p>
    <p style="text-align:center;font-size:130%;"> <b> Click a button below to reveal a map. </b> </p>
    <p> <br> </p>

    <!-- Menus for each map, initailized -->
    <center> <button class="collap" style="color:#0E0C86"> <b> Precipitation </b> </button>
    <div class="content">
      <p> <br> </p>
      <div id="map1"> </div> <!-- Initialize map1 and legend1 -->
        <div id='time_series'>
          <h1 style="background:rgb(153, 255, 173);color:black;font-size:180%;">Month</h1>
          <div class='session' style="background:linear-gradient(to left, #7BBDBF, #90E5E8);" id='sliderbar1'>
            <h2><label id='a_month1'>Jan</label> 1999</h2>
            <input id='slider1' class='row' type='range' min='0' max='11' step='1' value='0'/>
            <div>
              <a href="javascript:void(0);"> <div id="button11" onclick="reveal1()">
              <img src="https://cdn3.iconfinder.com/data/icons/photo-12/500/842-512.png"
                alt="Play"
                style="width:50px;
                align:center"/> </div> </a> <div id="txt1" style="padding:10px;"> <b> Playing... </b> </div>
              <a href="javascript:void(0);"> <div id="button12" onclick="reveal2()">
                <img src="https://cdn0.iconfinder.com/data/icons/vector-basic-tab-bar-icons/48/pause_button-512.png"
                  alt="Pause"
                  style="width:50px;
                  align:center"> </div> </a> <div id="txt2" style="padding:10px;"> <b> Paused </b> </div>
            </div>
          </div>
        </div>
        <p> <br> </p>
        <div class='map-overlay1' id='legend1'></div>
          <h5> Precipitation values are in inches. <br> <br> County boundaries determined by the 1999 population estimate (darker/thicker = more densely populated). <br> <br> Use the play/pause button to start/stop timelapse. <br> <br> Map has hover and click (pop-up) functionalities. <br> <br> Right-click and drag for a 3-D effect at any time. </h5>
        </div> </center>
        <p> <br> </p>
      <center> <button class="collap" style="color:#785C0E"> <b> Temperature </b> </button>
        <div class="content">
          <p> <br> </p>
          <div id="map2"> </div> <!-- Initialize map2 and legend2 -->
          <div id='time_series'>
            <h1 style="background:rgb(250, 130, 100);color:black;font-size:180%;">Month</h1>
            <div class='session' style="background:linear-gradient(to left, #7BBDBF, #90E5E8);" id='sliderbar2'>
              <h2><label id='a_month2'>Jan</label> <div id="onlythisone">1999 </div></h2>
              <input id='slider2' class='row' type='range' min='0' max='11' step='1' value='0'/>
              <div>
                <a href="javascript:void(0);"> <div id="button21" onclick="reveal3()">
                <img src="https://cdn3.iconfinder.com/data/icons/photo-12/500/842-512.png"
                  alt="Play"
                  style="width:50px;
                  align:center"/> </div> </a> <div id="txt3" style="padding:10px;"> <b> Playing... </b> </div>
                <a href="javascript:void(0);"> <div id="button22" onclick="reveal4()">
                  <img src="https://cdn0.iconfinder.com/data/icons/vector-basic-tab-bar-icons/48/pause_button-512.png"
                    alt="Pause"
                    style="width:50px;
                    align:center"/> </div> </a> <div id="txt4" style="padding:10px;"> <b> Paused </b> </div>
              </div>
            </div>
          </div>
          <p> <br> </p>
          <div class='map-overlay2' id='legend2'></div>
          <h5> Temperature values are in Fahrenheit. <br> <br> County boundaries determined by the 1999 population estimate (darker/thicker = more densely populated). <br> <br> Use the play/pause button to start/stop a timelapse. While paused, map will oscillate between the estimated 1895 and 1999 means for that month. <br> <br> Map has hover and click (pop-up) functionalities. <br> <br> Right-click and drag for a 3-D effect at any time. </h5>
        </div> </center>

    <!-- Description below maps -->
    <p> <br> </p>
    <center> <button class="collap" style="color:#785C0E"> <b> Temperature Anomalies </b> </button>
      <div class="content" style="width:45%;background-color:"#999";">
        <center> <a href= "https://raw.githubusercontent.com/ermian98-uw/GIS/main/Anderson_Lab4/TA.jpg" download>
          <img src="https://raw.githubusercontent.com/ermian98-uw/GIS/main/Anderson_Lab4/TA.jpg" alt="Texas Anomalies" style="width:100%"> </center>
          <p style="color:black;font-size:115%;"> <b> Click to zoom. </b> </p>
        </a>
        <p style="color:black;"> Color-coded 100-year temperature anomalies by county; hotter colors indicate greatest warmth trends. </p>
        <p> <br> </p>
      </div> </center>
    <p> <br> </p>
    <p style="font-size:95%;text-align:center;"> <i> (Preview my customized Mapbox style <a target="_blank" href=https://api.mapbox.com/styles/v1/ermian98/ckhws5qm105i819phtroyx21o.html?fresh=true&title=view&access_token=pk.eyJ1IjoiZXJtaWFuOTgiLCJhIjoiY2tnaXVwYWtrMGEwbjJ1cGRlZDQ2bmd1OCJ9.gy2NOY8e3cmhzG6JiEyj4A>here</a>) </i> </p>

    <p id="divide">
    <p> <br> As you saw hidden within the buttons, the two choropleth maps describe temperature and precipitation for each Texas county in 1999 (as obtained by the NCDC). Note that the geographic center of Texas is at the coordinates [-99.1704, 31.3912] (northeastern McColloch County). </p>
    <p> <br> Three counties (Ellis, Kaufman, Kinney) out of 254 miraculously report lower mean annual temperature than ~100 years prior. The others show a clear spatial distribution, with far-west counties warming the most (+2.5 degrees F). Note that some of the urban space values are slightly higher than their rural neighbors (especially the Austin and Temple region). </p>
    <p> <br> Precipitation accumulation very clearly varies over the year. The northern and eastern counties are the wettest but see more precipitation in the cooler months (because of low pressure systems influenced by the Arctic), while the southern and western counties see more precipitation in the warmer months (because of equatorial weather patterns bringing in more tropical storms). </p>
    <p> <br> Local weather analyses such as these are interesting to me. My Capstone project for the Master of Science in Geospatial Technologies will tackle a similar subject by investigating ways to more accurately estimate temperature across topologically diverse land surfaces. </p>
    <p> <br> <u> <b> Note:</b></u> I understand this is a somewhat silly and not robust climate analysis; but, the data were readily available and the maps still tell a compelling story. </p>

    <p> <br> </p>
    <p id="divide"> <!-- References and conclusion -->
    <p> <br> <br> <b> <u style="font-size:125%;"> Data Sources: </u> </b> <br>
          <br> (1.) &nbsp; <a target="_blank" href="https://www.ncdc.noaa.gov/cag/county/mapping/"> https://www.ncdc.noaa.gov/cag/county/mapping/</a> <br> Climate Data provided by the NCDC (National Centers for Environmental Information). Data was downloaded as a comma-separated file. Temporal information was modified in order to convert to a geoJSON file online. No other modifications were made to the dataset.
          <br> <br> (2.) &nbsp; <a target="_blank" href="https://www.washingtonpost.com/climate-environment/2020/08/07/how-use-posts-climate-data-analysis/"> https://www.washingtonpost.com/climate-environment/2020/08/07/how-use-posts-climate-data-analysis/</a> <br> Temperature Anomaly and Population Data. Part of a climate change analysis performed by Washington Post staff in August 2020.
          <br> <br> (3.) &nbsp; <a target="_blank" href="https://data.texas.gov/Government-and-Taxes/County-Map/48ag-x9aa"> https://data.texas.gov/Government-and-Taxes/County-Map/48ag-x9aa</a> <br> Texas Counties GEOJSON. Manually added precipitation and temperature fields from the NCDC source, as well as temperature anomaly and population fields from the Washington Post source. </p>
    <p> <br> </p>
    <p> <br> </p>
    <p> <br> </p>
    <div id="bottom">
      <img src="https://cdn.iconscout.com/icon/free/png-512/corner-arrow-1767447-1502517.png"
        alt="Arrow Right"
        style="width:100px;
        margin-left: 500px;
        float:left;
        align:center"/>
      <center> <p style="float:left;font-size:165%;border:solid;border-width:6px;background:linear-gradient(to left, #105473, #621073);width:20%;font-family:"Monaco",fantasy;"> <a style="color:#F0F00F;" href="https://ermian98-uw.github.io/GIS/welcome.html"> <br> Home <br> <br> </a> </p> </center>
      <img src="https://cdn.iconscout.com/icon/free/png-512/corner-arrow-1767538-1502442.png"
        alt="Arrow Left"
        style="width:100px;
        float:left;
        align:center"/>
    <p style="padding:75px;"> <br> </p>

    <script> // begin JavaScript
			mapboxgl.accessToken = "pk.eyJ1IjoiZXJtaWFuOTgiLCJhIjoiY2tnaXVwYWtrMGEwbjJ1cGRlZDQ2bmd1OCJ9.gy2NOY8e3cmhzG6JiEyj4A";
			var map1 = new mapboxgl.Map({
			  container: "map1",
			  style: "mapbox://styles/ermian98/ckhws5qm105i819phtroyx21o", // import custom style
			  center: [-99.1704,31.3912], // geographic center of Texas
			  zoom: 4.6 // set zoom to Texas
			});
      var map2 = new mapboxgl.Map({
        container: "map2",
        style: "mapbox://styles/ermian98/ckhws5qm105i819phtroyx21o", // import custom style
        center: [-99.1704,31.3912], // geographic center of Texas
        zoom: 4.6 // set zoom to Texas
      });
      map1.addControl(new mapboxgl.NavigationControl());
      map2.addControl(new mapboxgl.NavigationControl());
      map1.addControl(new mapboxgl.FullscreenControl());
      map2.addControl(new mapboxgl.FullscreenControl());

      // Basic popups for geographic center
      var popup1 = new mapboxgl.Popup( {className: "quickstart-popup"} )
        .setLngLat([-99.1704,30.3912])
        .setHTML("<b> Click play or move slider to begin </b>")
        .addTo(map1);
      var popup2 = new mapboxgl.Popup( {className: "quickstart-popup"} )
        .setLngLat([-99.1704,30.3912])
        .setHTML("<b> Click play or move slider to begin </b>")
        .addTo(map2);
      var mystring = "PJan_1999";
      var months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

      reveal1(); reveal2(); reveal3(); reveal4();

      var active1 = false;
      var cycleMonths1 = " ";
      var monthSlider1 = document.getElementById('slider1');
      var curMonthIndex1 = -1;
      function advanceMonth1() {
        ++curMonthIndex1;
        if (curMonthIndex1 >= months.length) {
            curMonthIndex1 = 0;
        }
        return curMonthIndex1;
      }

      function slide1(month) {
          var m_dis = " ";
          parseInt(month);
        if (month % 12 == 0) {
          m_dis = "Jan"; mystring = "PJan_1999";
        } else if (month % 12 == 1) { m_dis = "Feb"; mystring = "PFeb_1999";
        } else if (month % 12 == 2) { m_dis = "Mar"; mystring = "PMar_1999";
        } else if (month % 12 == 3) { m_dis = "Apr"; mystring = "PApr_1999";
        } else if (month % 12 == 4) { m_dis = "May"; mystring = "PMay_1999";
        } else if (month % 12 == 5) { m_dis = "Jun"; mystring = "PJun_1999";
        } else if (month % 12 == 6) { m_dis = "Jul"; mystring = "PJul_1999";
        } else if (month % 12 == 7) { m_dis = "Aug"; mystring = "PAug_1999";
        } else if (month % 12 == 8) { m_dis = "Sep"; mystring = "PSep_1999";
        } else if (month % 12 == 9) { m_dis = "Oct"; mystring = "POct_1999";
        } else if (month % 12 == 10) { m_dis = "Nov"; mystring = "PNov_1999";
        } else if (month % 12 == 11) { m_dis = "Dec"; mystring = "PDec_1999";
        }
        // update the map by removing and adding again
        popup1.remove();
        map1.removeLayer("counties1");
        map1.removeLayer("counties2");
        map1.removeLayer("counties3");
        map1.removeLayer("pop1");
        map1.addLayer({
					"id":"counties1",
          "type":"fill",
					"source": "counties_P",
          'paint': {
            'fill-color': "rgb(230, 181, 58)", // base color (dryest counties, covers basemap)
            'fill-opacity': 1
          }
				});
        map1.addLayer({
          "id":"counties2",
          "type":"fill",
          "source": "counties_P",
          'paint': {
            'fill-color': "rgb(0, 181, 58)", // amount of rainfall dictates opacity of green
            'fill-opacity': ['/',['+',1,['number', ['get', mystring],0]],3]
          }
        });
        map1.addLayer({
          "id":"counties3",
          "type":"fill",
          "source": "counties_P",
          'paint': {
            'fill-color': "rgb(0, 0, 0)", // hover layer
            'fill-opacity': ['case',['boolean',['feature-state','hover'],false],0.5,0]
          }
        });
        map1.addLayer({ // population estimate for 1999 (approx 30% less than 2018)
          "id":"pop1",
          "type":"line",
          "source": "counties_P",
          'paint': {
            'line-color': ['case',
                            ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 5000], "#DDDDDD",
                            ['all', ['>=', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 5000], ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 24999]], "#BBBBBB",
                            ['all', ['>=', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 25000], ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 74999]], "#999999",
                            ['all', ['>=', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 75000], ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 149999]], "#666666",
                            ['>=', ['number', ['get', "POPESTIMATE2018"]], 150000], "#444444", "#222222"], // hover layer
            'line-width': ['case',
                            ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 100], 0.3,
                            ['all', ['>=', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 100], ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 999]], .6,
                            ['all', ['>=', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 1000], ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 9999]], 1.2,
                            ['all', ['>=', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 10000], ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 99999]], 2.4,
                            ['>=', ['number', ['get', "POPESTIMATE2018"]], 100000], 4.8, 9.6]
          }
        });
        document.getElementById('a_month1').innerText = m_dis;
        document.getElementById('slider1').value = month;  // update text in the slider UI
      };

      document.getElementById('slider1').addEventListener('input', function(e) {
        slide1(parseInt(e.target.value));
      })

       document.getElementById('button12').addEventListener("click", function(e) {
         window.clearInterval(cycleMonths1);
         active1 = false;
       })

      document.getElementById('button11').addEventListener("click", function(e) {
        if (!active1) {
          active1 = true;
          cycleMonths1 = window.setInterval(function() {slide1(advanceMonth1())}, 750);
        }

      })

      // Add GeoJSON layers (this makes )
			map1.on('load', function(){ // map with precip values
        var counties_P = "TX_counties2.geojson"
        var Tcounties = "counties.geojson"
				map1.addSource("counties_P", {
							"type": "geojson",
							"data": "https://raw.githubusercontent.com/ermian98-uw/GIS/main/Anderson_Lab4/TX_counties2.geojson",
              'generateId': true
					});
			});

      // populating first legend
      var precip = ['<b><u>Legend:</u></b>', ' ', 'Wettest', 'Wet', 'Dry', 'Dryest', ' ', 'Urban Spaces'];
      var cols1 = ['#000000', '#99FFAD', '#27E6E6', '#00B539', '#AFB539', '#E6B53A', '#99FFAD', "#444444"];
      for (i = 0; i < precip.length; i++) {
        var p = precip[i];
        var col1 = cols1[i];
        var item = document.createElement('div');
        var key = document.createElement('span');
        key.className = 'legend-key';
        key.style.backgroundColor = col1;
        var value = document.createElement('span');
        value.innerHTML = p;
        item.appendChild(key);
        item.appendChild(value);
        legend1.appendChild(item);
      }

      var active2 = false;
      var cycleMonths2 = " ";
      var cycleYear = " ";
      var move = 1;
      var monthSlider2 = document.getElementById('slider2');
      var curMonthIndex2 = -1;
      function advanceMonth2() {
        ++curMonthIndex2;
        if (curMonthIndex2 >= months.length) {
            curMonthIndex2 = 0;
        }
        return curMonthIndex2;
      }

      function slide2(month) {
          var m_dis = " ";
          parseInt(month);
        if (month % 12 == 0) {
          m_dis = "Jan"; mystring = "TJan_1999";
        } else if (month % 12 == 1) { m_dis = "Feb"; mystring = "TFeb_1999";
        } else if (month % 12 == 2) { m_dis = "Mar"; mystring = "TMar_1999";
        } else if (month % 12 == 3) { m_dis = "Apr"; mystring = "TApr_1999";
        } else if (month % 12 == 4) { m_dis = "May"; mystring = "TMay_1999";
        } else if (month % 12 == 5) { m_dis = "Jun"; mystring = "TJun_1999";
        } else if (month % 12 == 6) { m_dis = "Jul"; mystring = "TJul_1999";
        } else if (month % 12 == 7) { m_dis = "Aug"; mystring = "TAug_1999";
        } else if (month % 12 == 8) { m_dis = "Sep"; mystring = "TSep_1999";
        } else if (month % 12 == 9) { m_dis = "Oct"; mystring = "TOct_1999";
        } else if (month % 12 == 10) { m_dis = "Nov"; mystring = "TNov_1999";
        } else if (month % 12 == 11) { m_dis = "Dec"; mystring = "TDec_1999";
        }
        // update the map by removing and adding again
        popup2.remove();
        map2.removeLayer("counties4");
        map2.removeLayer("counties5");
        map2.removeLayer("counties6");
        map2.removeLayer("pop2");
        map2.addLayer({
          "id":"counties4",
          "type":"fill",
          "source": "counties_T",
          'paint': {
            'fill-color': ['case', // conditional styling of county fill colors
                            ['<', ['number', ['get', mystring]], 35], "#00FFFF",
                            ['all', ['>=', ['number', ['get', mystring]], 35], ['<', ['number', ['get', mystring]], 40]], "#00FFC3",
                            ['all', ['>=', ['number', ['get', mystring]], 40], ['<', ['number', ['get', mystring]], 45]], "#00FF88",
                            ['all', ['>=', ['number', ['get', mystring]], 45], ['<', ['number', ['get', mystring]], 50]], "#09FF00",
                            ['all', ['>=', ['number', ['get', mystring]], 50], ['<', ['number', ['get', mystring]], 55]], "#51FF00",
                            ['all', ['>=', ['number', ['get', mystring]], 55], ['<', ['number', ['get', mystring]], 60]], "#A2FF00",
                            ['all', ['>=', ['number', ['get', mystring]], 60], ['<', ['number', ['get', mystring]], 65]], "#EAFF00",
                            ['all', ['>=', ['number', ['get', mystring]], 65], ['<', ['number', ['get', mystring]], 70]], "#FFBB00",
                            ['all', ['>=', ['number', ['get', mystring]], 70], ['<', ['number', ['get', mystring]], 75]], "#FF6F00",
                            ['all', ['>=', ['number', ['get', mystring]], 75], ['<', ['number', ['get', mystring]], 80]], "#FF1500",
                            ['all', ['>=', ['number', ['get', mystring]], 80], ['<', ['number', ['get', mystring]], 85]], "#FF1500",
                            "#FF00BF"],
            'fill-opacity': 1
          }
        });
        if (move % 2 == 0) {
          map2.addLayer({
            "id":"counties6",
            "type":"fill",
            "source": "counties_T",
            'paint': {
              'fill-color': ['case', // conditional styling of county fill colors
                              ['<', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 35], "#00FFFF",
                              ['all', ['>=', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 35], ['<', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 40]], "#00FFC3",
                              ['all', ['>=', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 40], ['<', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 45]], "#00FF88",
                              ['all', ['>=', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 45], ['<', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 50]], "#09FF00",
                              ['all', ['>=', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 50], ['<', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 55]], "#51FF00",
                              ['all', ['>=', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 55], ['<', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 60]], "#A2FF00",
                              ['all', ['>=', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 60], ['<', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 65]], "#EAFF00",
                              ['all', ['>=', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 65], ['<', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 70]], "#FFBB00",
                              ['all', ['>=', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 70], ['<', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 75]], "#FF6F00",
                              ['all', ['>=', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 75], ['<', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 80]], "#FF1500",
                              ['all', ['>=', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 80], ['<', ['-',['number', ['get', mystring]],['number', ['get', "tempchg"]]], 85]], "#FF1500",
                              "#FF00BF"],
              'fill-opacity': 1
            }
          });
        }
        map2.addLayer({
          "id":"counties5",
          "type":"fill",
          "source": "counties_T",
          'paint': {
            'fill-color': "rgb(0, 0, 0)", // hover layer
            'fill-opacity': ['case',['boolean',['feature-state','hover'],false],0.5,0]
          }
        });
        map2.addLayer({ // population estimate for 1999 (approx 30% less than 2018)
          "id":"pop2",
          "type":"line",
          "source": "counties_T",
          'paint': {
            'line-color': ['case',
                            ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 5000], "#DDDDDD",
                            ['all', ['>=', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 5000], ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 24999]], "#BBBBBB",
                            ['all', ['>=', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 25000], ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 74999]], "#999999",
                            ['all', ['>=', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 75000], ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 149999]], "#666666",
                            ['>=', ['number', ['get', "POPESTIMATE2018"]], 150000], "#444444", "#222222"], // hover layer
            'line-width': ['case',
                            ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 100], 0.3,
                            ['all', ['>=', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 100], ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 999]], .6,
                            ['all', ['>=', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 1000], ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 9999]], 1.2,
                            ['all', ['>=', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 10000], ['<', ['*', ['number', ['get', "POPESTIMATE2018"]], 0.7], 99999]], 2.4,
                            ['>=', ['number', ['get', "POPESTIMATE2018"]], 100000], 4.8, 9.6]
          }
        });
        document.getElementById('a_month2').innerText = m_dis;
        document.getElementById('slider2').value = month;
        if (move % 2 == 1) { document.getElementById('onlythisone').innerText = "1999";}
        else { document.getElementById('onlythisone').innerText = "1895"; } // update text in the slider UI
      };

      document.getElementById('slider2').addEventListener('input', function(e) {
        slide2(parseInt(e.target.value));
        window.clearInterval(cycleYear);
        cycleYear = window.setInterval(function() {
          move = move + 1
          slide2(parseInt(e.target.value)); }, 2000);
      })

      function optevent() { // for next few lines
          slide2(parseInt(document.getElementById('slider2').value))
      }

       document.getElementById('button22').addEventListener("click", function(e) {
         window.clearInterval(cycleMonths2);
         active2 = false;
         cycleYear = window.setInterval(function() {
           move = move + 1
           optevent(); }, 2000);
       })

      document.getElementById('button21').addEventListener("click", function(e) {
        if (!active2) {
          window.clearInterval(cycleYear);
          move = 1;
          active2 = true;
          cycleMonths2 = window.setInterval(function() {slide2(advanceMonth2()) }, 750);
        }
      })

      map2.on('load', function(){ // map with temp values
        var counties_T = "TX_counties2.geojson"
        map2.addSource("counties_T", {
              "type": "geojson",
              "data": "https://raw.githubusercontent.com/ermian98-uw/GIS/main/Anderson_Lab4/TX_counties2.geojson",
              'generateId': true
          });
  			});

        // populating second legend
        var heat = ['<b><u>Legend:</u></b>', ' ', 'Below 35°F', '35°F - 40°F', '40°F - 45°F', '45°F - 50°F', '50°F - 55°F', '55°F - 60°F', '60°F - 65°F', '65°F - 70°F', '70°F - 75°F', '75°F - 80°F', '80°F - 85°F', 'Above 85°F', ' ', 'Urban Spaces'];
        var cols2 = ['#000000', '#FA8264', '#00FFFF', '#00FFC3', '#00FF88', '#09FF00', '#51FF00', '#A2FF00', "#EAFF00", "#FFBB00", "#FF6F00", "#FF1500", "#FF005D", "#FF00BF", '#FA8264', "#444444"];
        for (i = 0; i < heat.length; i++) {
          var h = heat[i];
          var col2 = cols2[i];
          var item = document.createElement('div');
          var key = document.createElement('span');
          key.className = 'legend-key';
          key.style.backgroundColor = col2;
          var value = document.createElement('span');
          value.innerHTML = h;
          item.appendChild(key);
          item.appendChild(value);
          legend2.appendChild(item);
        }

        // custom popups for county and precipitation information on map 1
        map1.on('click', 'counties3', function (e) {
          var type = e.features[0].properties.PJan_1999;
          if (mystring.includes("PFeb_1999")) {
            type = e.features[0].properties.PFeb_1999;
          } else if (mystring.includes("PMar_1999")) { type = e.features[0].properties.PMar_1999;
          } else if (mystring.includes("PApr_1999")) { type = e.features[0].properties.PApr_1999;
          } else if (mystring.includes("PMay_1999")) { type = e.features[0].properties.PMay_1999;
          } else if (mystring.includes("PJun_1999")) { type = e.features[0].properties.PJun_1999;
          } else if (mystring.includes("PJul_1999")) { type = e.features[0].properties.PJul_1999;
          } else if (mystring.includes("PAug_1999")) { type = e.features[0].properties.PAug_1999;
          } else if (mystring.includes("PSep_1999")) { type = e.features[0].properties.PSep_1999;
          } else if (mystring.includes("POct_1999")) { type = e.features[0].properties.POct_1999;
          } else if (mystring.includes("PNov_1999")) { type = e.features[0].properties.PNov_1999;
          } else if (mystring.includes("PDec_1999")) { type = e.features[0].properties.PDec_1999;
          }
          new mapboxgl.Popup()
          .setLngLat(e.lngLat)
          .setHTML("<b>" + e.features[0].properties.name + " County:" + "</b> <br> Population: "
                    + Math.round(0.7*e.features[0].properties.POPESTIMATE2018) + "<br> <br>"
                    + type + " inches of rain in " + mystring.substring(1,4) + " " + mystring.substring(5,9) + "<br>")
          .addTo(map1);
        });

        // custom popups for county and temperature information on map 2
        map2.on('click', 'counties5', function (e) {
          var type = e.features[0].properties.TJan_1999;
          if (mystring.includes("TFeb_1999")) {
            type = e.features[0].properties.TFeb_1999;
          } else if (mystring.includes("TMar_1999")) { type = e.features[0].properties.TMar_1999;
          } else if (mystring.includes("TApr_1999")) { type = e.features[0].properties.TApr_1999;
          } else if (mystring.includes("TMay_1999")) { type = e.features[0].properties.TMay_1999;
          } else if (mystring.includes("TJun_1999")) { type = e.features[0].properties.TJun_1999;
          } else if (mystring.includes("TJul_1999")) { type = e.features[0].properties.TJul_1999;
          } else if (mystring.includes("TAug_1999")) { type = e.features[0].properties.TAug_1999;
          } else if (mystring.includes("TSep_1999")) { type = e.features[0].properties.TSep_1999;
          } else if (mystring.includes("TOct_1999")) { type = e.features[0].properties.TOct_1999;
          } else if (mystring.includes("TNov_1999")) { type = e.features[0].properties.TNov_1999;
          } else if (mystring.includes("TDec_1999")) { type = e.features[0].properties.TDec_1999;
          }
          var temp1895 = (type - e.features[0].properties.tempchg).toFixed(1);
          new mapboxgl.Popup()
          .setLngLat(e.lngLat)
          .setHTML("<b>" + e.features[0].properties.name + " County:" + "</b> <br> Population: "
                    + Math.round(0.7*e.features[0].properties.POPESTIMATE2018) + "<br> <br> Mean Temp in "+ mystring.substring(1,4) + " " + mystring.substring(5,9) + ": " + type + "\u00B0F"
                    + " <br> Est. Temp Increase (since 1895): " + e.features[0].properties.tempchg.toFixed(2) + "\u00B0F"
                    + " <br> Est. Temp in " + mystring.substring(1,4) + " 1895: " + temp1895 + "\u00B0F")
          .addTo(map2);
        });

        // code to activiate hover mode with cursor (both maps)
        var hoveredStateId = null;
        map1.on('mousemove', 'counties3', (e) => {
          map1.getCanvas().style.cursor = 'pointer';
          if (e.features.length > 0) {
            if (hoveredStateId) {
              map1.removeFeatureState({
                source: "counties_P",
                id: hoveredStateId
              });
            }
            hoveredStateId = e.features[0].id;
            map1.setFeatureState({
              source: 'counties_P',
              id: hoveredStateId,
            }, { hover: true });
          }
        });
        map1.on("mouseleave", "counties3", function() {
          if (hoveredStateId) {
            map1.setFeatureState({
              source: 'counties_P',
              id: hoveredStateId
            }, { hover: false });
          }
        });

        var hoveredStateId2 = null;
        map2.on('mousemove', 'counties5', (e) => {
          map2.getCanvas().style.cursor = 'pointer';
          if (e.features.length > 0) {
            if (hoveredStateId2) {
              map2.removeFeatureState({
                source: "counties_T",
                id: hoveredStateId2
              });
            }
            hoveredStateId2 = e.features[0].id;
            map2.setFeatureState({
              source: 'counties_T',
              id: hoveredStateId2,
            }, { hover: true });
          }
        });
        map2.on("mouseleave", "counties5", function() {
          if (hoveredStateId2) {
            map2.setFeatureState({
              source: 'counties_T',
              id: hoveredStateId2
            }, { hover: false });
          }
        });

      // collapsible menu code
      var coll = document.getElementsByClassName("collap");
      for (j = 0; j < coll.length; j++) {
        coll[j].addEventListener("click", function() {
          this.classList.toggle("active");
          var content = this.nextElementSibling;
          if (content.style.maxHeight){
            content.style.maxHeight = null;
          } else {
            content.style.maxHeight = content.scrollHeight + "px";
          }
        });
      }

      // displaying appropriate Start and Pause text in slider
      function reveal1() {
        var x = document.getElementById("txt1");
        var y = document.getElementById("txt2");
        if (!active1) {
          if (x.style.display === "none") {
            x.style.display = "block";
            y.style.display = "none";
          } else {
            x.style.display = "none";
          }
        }
      }
      function reveal2() {
        var x = document.getElementById("txt2");
        var y = document.getElementById("txt1");
        if (active1) {
          if (x.style.display === "none") {
            x.style.display = "block";
            y.style.display = "none";
          } else {
            x.style.display = "none";
          }
        }
      }
      function reveal3() {
        var x = document.getElementById("txt3");
        var y = document.getElementById("txt4");
        if (!active2) {
          if (x.style.display === "none") {
            x.style.display = "block";
            y.style.display = "none";
          } else {
            x.style.display = "none";
          }
        }
      }
      function reveal4() {
        var x = document.getElementById("txt4");
        var y = document.getElementById("txt3");
        if (active2) {
          if (x.style.display === "none") {
            x.style.display = "block";
            y.style.display = "none";
          } else {
            x.style.display = "none";
          }
        }
      }
		</script>
  </body>
</html>
